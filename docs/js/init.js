!function(){const e=new Promise((e=>{"interactive"===document.readyState?e():window.addEventListener("DOMContentLoaded",(()=>e()))}));window.recipes={public:[],local:[],get all(){return this.public.concat(this.local)},get favourised(){const e=JSON.parse(localStorage.favourites);return this.all.filter((i=>e.includes(i.identifier)))},updateLocalRecipes(){t(),r()}};const i=class extends Array{constructor(e){super(),Object.assign(this,e)}filtrate({searchvalue:e="",maxCookingTime:i,difficulty:r,diets:t=[]}){const a=(new Date).getTime(),o=e.toLowerCase().split(/\s+/g).filter((e=>!!e));return this.filter((s=>{if(o.length>0&&o.every((e=>s.name.toLowerCase().search(e)<0)))return;if(""!==i&&(!s.cookingTime||s.cookingTime>i))return;if(r&&(!s.difficulty||s.difficulty!==Number(r)))return;if(!(0===t.length||s.diets&&t.every((e=>s.diets.indexOf(e)>=0))))return;s.relevancy=0,e&&(o.forEach((e=>{s.name.toLowerCase().includes(e)&&(s.relevancy+=1)})),o.every((e=>s.name.toLowerCase().search(e)>=0))&&(s.relevancy+=2));let n=(a-s.published)/1e3/60/60/24;return s.relevancy+=Math.min(s.favourisations/n/5,2),n<7&&(s.relevancy+=.5-n/14),"localStorage"===s.source&&(s.relevancy+=1),!0}))}order(e){if(this.sort(((e,i)=>new Intl.Collator("de").compare(e.name,i.name))),"relevancy"===e)this.sort(((e,i)=>i.relevancy-e.relevancy));else{if("cookingTime"===e)return this.sort(((e,i)=>e.cookingTime-i.cookingTime)),this.filter((e=>e.cookingTime));"creationDate"===e?this.sort(((e,i)=>i.published-e.published)):"popularity"===e&&this.sort(((e,i)=>i.favourisations-e.favourisations))}return this}},r=()=>{recipes.local=new i(JSON.parse(localStorage.recipes).map((e=>(e.source="localStorage",e))))},t=()=>{localStorage.recipes=JSON.stringify(recipes.local)};window.initialized=new Promise((async t=>{localStorage.recipes||(localStorage.recipes=JSON.stringify([])),localStorage.favourites||(localStorage.favourites=JSON.stringify([])),r(),await(async()=>{const e=await fetch("assets/recipelist.json"),r=await e.json();recipes.public=new i(r.map((e=>(e.source="JSONFile",e))))})(),await e,t()})),window.initializedlocalRecipeImages=new Promise((i=>{const r=indexedDB.open("images",1);r.onupgradeneeded=e=>{localRecipeImages=e.target.result,localRecipeImages.createObjectStore("imagesStore",{keyPath:"identifier"})},r.onerror=e=>console.log(e.target.error),r.onsuccess=async r=>{localRecipeImages=r.target.result,localRecipeImages.onerror=e=>console.log(e.target.error),await e,i()}}))}();